<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8">
  <title>ê¸€ ë³´ê¸°</title>
  <link rel="stylesheet" href="/assets/css/style.css">
</head>
<body>
  <article id="post-container"></article>
  <script>
    const params = new URLSearchParams(window.location.search);
    const id = params.get('id');

    fetch('/posts/' + id)
      .then(res => res.json())
      .then(post => {
        const container = document.getElementById('post-container');
        container.innerHTML = `
          <h2>\${post.title}</h2>
          <p><strong>ì¹´í…Œê³ ë¦¬:</strong> \${post.category}</p>
          <p>\${post.content.replace(/\n/g, '<br>')}</p>
        `;
      });
  
<p><button id="like-btn">ì¢‹ì•„ìš” ğŸ‘ (<span id="like-count">0</span>)</button></p>
<script>
  fetch('/likes/count/' + id)
    .then(res => res.json())
    .then(data => {
      document.getElementById('like-count').textContent = data.count;
    });

  document.getElementById('like-btn').onclick = async () => {
    const res = await fetch('/likes/toggle', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ post_id: id, user_id: 1 })
    });
    const result = await res.json();
    const delta = result.liked ? 1 : -1;
    const count = parseInt(document.getElementById('like-count').textContent) + delta;
    document.getElementById('like-count').textContent = count;
  };
</script>

</script>

<hr>
<section>
  <h3>ëŒ“ê¸€</h3>
  <form id="comment-form">
    <textarea name="content" rows="3" placeholder="ëŒ“ê¸€ì„ ì…ë ¥í•˜ì„¸ìš”..."></textarea><br>
    <button type="submit">ëŒ“ê¸€ ì‘ì„±</button>
  </form>
  <ul id="comment-list"></ul>
</section>
<script>
  const token = localStorage.getItem('token');  // ë¡œê·¸ì¸ í† í°ì´ ìˆë‹¤ë©´ (ë‹¨ìˆœí™”)

  fetch('/comments/' + id)
    .then(res => res.json())
    .then(comments => {
      const list = document.getElementById('comment-list');
      comments.forEach(c => {
        const li = document.createElement('li');
        li.innerHTML = `<strong>\${c.username}</strong>: \${c.content} <small>(\${c.created_at})</small>`;
        list.appendChild(li);
      });
    });

  document.getElementById('comment-form').onsubmit = async (e) => {
    e.preventDefault();
    const content = e.target.content.value;
    const user_id = 1; // í…ŒìŠ¤íŠ¸ìš© ì‚¬ìš©ì ID (ë¡œê·¸ì¸ ì‹œìŠ¤í…œ ë„ì… ì‹œ ìˆ˜ì • í•„ìš”)

    const res = await fetch('/comments/create', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ post_id: id, user_id, content })
    });

    const result = await res.json();
    if (result.success) {
      alert('ëŒ“ê¸€ ë“±ë¡ ì™„ë£Œ');
      location.reload();
    } else {
      alert('ëŒ“ê¸€ ë“±ë¡ ì‹¤íŒ¨');
    }
  };

<p><button id="like-btn">ì¢‹ì•„ìš” ğŸ‘ (<span id="like-count">0</span>)</button></p>
<script>
  fetch('/likes/count/' + id)
    .then(res => res.json())
    .then(data => {
      document.getElementById('like-count').textContent = data.count;
    });

  document.getElementById('like-btn').onclick = async () => {
    const res = await fetch('/likes/toggle', {
      method: 'POST',
      headers: { 'Content-Type': 'application/json' },
      body: JSON.stringify({ post_id: id, user_id: 1 })
    });
    const result = await res.json();
    const delta = result.liked ? 1 : -1;
    const count = parseInt(document.getElementById('like-count').textContent) + delta;
    document.getElementById('like-count').textContent = count;
  };
</script>

</script>

</body>
</html>
